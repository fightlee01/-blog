# 缓存原理
> 2018.8.15
## 前言
    看了两篇比较好的bolg，其中一篇将的比较详细但是相对的难易理解，另一篇就比较符合我的口味，趁着有时间就做做总结。
## 正文
### 一、缓存的大致流程
通过使用缓存，可以让客户端快速的获取到数据，最主要的是能够让服务器减少很多请求的处理；而缓存一般会存储在客户端、代理服务器（CDN)上，一般使用策略有：一通过服务端返回资源最后一次更改时间（Last-Modified），然后客户端或者代理服务器在缓存资源过期后，将更改时间（If-Modified-Since）发送给服务端给对比上次更改时间是否一致，如果一致则更新缓存有效期并返回304（not modified），如果不一致则重新发送资源；二也是通过服务端返回一个hash（Etag）表示资源内容的状态，再缓存资源过期后发送这个hash（If-No-Match）给服务端来判断资源内容是否有改变。明显后面这种更加高效，因为使用缓存更改时间来判断缓存资源是否更改，其在服务端的可能内容并没有改变，但是更改了更改时间，这并没有通过hash表示资源内容状态来的更加直接，这样就能在缓存资源真正改版了才去更新缓存资源。

大体可以看出缓存机制是通过给资源一个标志，来判断资源新鲜度是否`过期`，来作为缓存资源的更新策略，如果没有`过期`则直接使用缓存，如果`过期`了则先更新缓存然后使用。

![image](/img/12.png)
### 二、cache-control和expires
#### 1.cache-control
cache-control是HTTP1.1定义缓存策略的字段，了解一下主要的字段就可以大致了解它的作用
- max-age: 一个相对时间，表示缓存资源的有效期，浏览器从收到响应头后开始计时，在这个相对时间内不会再向服务器发送请求
- public: 表示响应可以被代理服务器缓存，允许被多个用户共享，如果没有指定private，默认则是public。
- private：表示响应只能被私有缓存中被缓存，不能被代理服务器缓存，一般在涉及用户私密信息的时候使用private。
- no-cache: 表示需要先发送请求与服务器确认资源是否被更改过，然后再确定是否使用缓存。
- no-stroe: 表示禁止缓存任何资源。

![image](/img/13.jpg)
#### 2.expires
expires是HTTP1.0使用的字段，这个字段的值只是一个日期，表示缓存在该日期过后就失效，需要重新想服务器获取，由于浏览器和服务器的时间可能会出现差错，所以在HTTP1.1的时候就使用cache-control下的max-age，它是使用相对时间。
### 三、缓存验证机制
#### 1.Etag和If-No-Match
Etag和If-No-Match是HTTP1.1使用的缓存验证机制，Etag是服务器根据资源内容生产的一个hash，表示资源的内容状态，服务端将这个Etag放入响应头中返回给客户端，然后在客户端需要验证缓存资源是否更改的时候则使用If-No-Match把Etag传递的hash传递给服务端，服务端根据这个hash来判断缓存资源是否过期。
![image](/img/14.png)
#### 2.If-Modified-Since和Last-Modified
这是HTTP1.0的缓存的验证机制，Last-Modified表示资源最近一次修改的时间，然后将其加入响应头发送给客户端，在客户端需要验证资源是否失效时，通过If-Modified-Since字段将保持的修改时间发送给服务端，然后服务端对比时间来判断缓存资源是否失效。
## 参考文章
- [前端必须要懂的浏览器缓存机制](https://www.tuicool.com/articles/baea2uy)
- [浅谈浏览器http的缓存机制](https://www.cnblogs.com/vajoy/p/5341664.html)
