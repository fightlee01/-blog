# 网络小结
>2018.8.1
## 前言
    网络有很多东西要学，范围涉及的很广，每一个都可以单独拿出来分析，这里只做一些简单的名词解释，会逐步增加内容。
## 正文
### 一、CDN
CDN（content delivery network）内容分发网络，一种优化用户上网体验的服务。由于一些用户离数据服务器很远，获取内容的时间往往会很长，为了降低访问时间，可以在用户附近多建立几个数据中心，但是这个成本高昂，而CDN就是属于一个公共服务（交钱就行），在用户周围建立大量的CDN服务器，利用服务器对一些访问的数据进行缓存，来提高用户的上网体验。大致流程是用户进行访问的时候，会被分配给最近的CDN服务器，然后CDN服务器会查询访问内容是否有缓存，如果有进一步查询缓存是否过期，如果过期了CDN在去要访问服务器去拉取内容并缓存下来（这个过程称为回源），再返回给用户，如果缓存没有过期就直接把数据返回给用户。总结下来CDN的做了两件事：1）让用户访问最近的节点；2）从缓存服务器或者源站（网络真实的服务器）上获取数据。
![image](/img/02.png)
### 二、网络整体和各层的大致作用
一个http请求传输的整个过程大致是：首先通过
### 三、关于代理
#### 1.什么是代理
代理也称作网络代理，是一种特殊的网络服务，允许一个网络终端通过这个服务与另一个网络终端进行非直接的连接。
代理的好处：
-   可以加快资源请求速度（通过代理服务器进行缓存）
-   隐藏真实IP(正向代理)
-   负载均衡（反向代理）
#### 2.正向代理和反向代理
正向代理和反向代理都是代理方式的一种，两者区别：一是、正向代理需要客户端设置代理地址，而反向代理不需要；然后代理过程：1）正向代理：客户端向代理服务器发送一个请求并制定服务器（原服务器），然后代理服务器向原服务器转交请求，并将获得的内容转交给客户端。2）反向代理：客户端向代理服务器的命名空间中的内容发送普通请求，接着代理服务器判断向何处转交请求，然后将获取的内容返回给客户端，就像这些内容是自己的一样。

#### 3.负载均衡
一般大型服务器集群用户是无法直接访问的且每个服务器的内容是一致的，利用反向代理的原理设置一个中心服务器（客户端不需要设置且请求不变），然后中心服务器会选择压力较小的服务器去访问，这样就能均衡服务器集群的的处理请求的压力，避免服务器奔溃。

### 四、cookie和session
    HTTP是无状态（无状态：每次HTTP请求对接受方来说都是新的，与前面的请求没有关联）的协议，故需要一种机制来实现状态的保存。
#### 1.cookie
cookie是服务端发送给客户端的少量信息（key: value形式），并在客户端存储。过程: 客户端在发送请求后，服务端根据是否要保存该客户端的信息来决定制作cookie，然后通过响应头的set-cookie字段发送给客户端，然后客户端将cookie保存到本地，后续发送请求的将cookie再随着HTTP一同发送给服务端识别。cookie的特点：1）容量先对较小，一般4kb；2）数量限制：不同浏览器对每个域名有限制cookie数量，大概是20~50个，如果多余这个数量就会起用一些策略来删除cookie，比如：随机删除、最近最少使用；3）同源限制：由于cookie只能在指定域名下使用，所以不能跨域，但是在同一域名下的不同端口可以使用；3）时间限制：cookie有设置过期时间，只有在该时间段内才能使用。缺点：由于存储在客户端，容易被别人盗用然后冒充，并不是很安全。
cookie的一些重要属性：
- name：cookie的名称，一旦创建，便不能修改。
- value: cookie的值
- domain: cookie作用域名
- path: cookie的使用路径，表示只有domain域名下的这个path下才能访问该cookie。
- maxAge: cookie的过期时间，为整时表示还有多长时间过期；为负时表示这是个临时cookie,在留言器关闭后会自动删除；为0时表示删除该cookie。
- isHTTPOnly:表示只有HTTP协议的请求才能对客户端的cookie进行访问。
#### 2.session
session的大致原理差不多，最大的区别是session保存在服务端，保证了安全性。过程：服务端在客户端发送的请求中是否包含session标识符——sessionId，如果有，说明已经为这个客户端创建过，然后通过这个sessionId来查找对应的session，如果没有检索出来说明服务端已经删除，然后服务端会创建一个新的session；如没有sessionId，则会创建一个session和与之关联的sessionId，然后在响应头中将sessionId发送给客户端，客户端将这个sessionId使用cookie存储，然后每次请求都会将这个sessionId发送给后端。session的特点：1）生命周期：session的生命周期指的是从Servlet容器创建session对象到销毁的过程。Servlet容器会依据session对象设置的存活时间，在达到session时间后将session对象销毁。session生成后，只要用户继续访问，服务器就会更新session的最后访问时间，并维护该session；2）有效期：session一般在内存中存放，为了防止内存溢出，会设置session的有效期（maxInactiveInterval字段）,也可以主动删除。
### 五、HTTPS
    HTTPS相对于HTTP会更加安全，保证数据不被监听篡改冒充等风险。
HTTPS是在应用层(HTTP)和传输层加了一层SSL/TLS，来完成加密。具体的加密算法有：对称加密和非对称加密。

- 对称加密：两端都持有一个相同的密钥，加密和解密都是用这个秘钥，相对实现简单但维护困难，密钥困难泄漏。
- 非对称加密：一般是客户端公钥加密发送内容，服务端私钥解密内容，但是相应内容可能是私钥加密，公钥进行解密，如果攻击者获取到响应内容是可以通过公钥进行解密获取内容的，所以也不是绝对安全。
-  两者结合：先通过非对称密钥将对策密钥发给有私钥的对方，然后后续通讯则使用对策密钥加密，这样保证了对策密钥不外泄的风险。

整个过程还差一个重要步骤，客户端如何获取公钥且确认服务端不是黑客冒充；现在是通过证书认证来完成，服务端发送证书给客户端，然后客户端将证书上传到颁发者的机构去认证，如果为真则取出里面的公钥，对证书签名进行解密，得到一个hash，然后与响应中的hash比较，如果一直则获取公钥和验证服务器的过程就成功了。
### 六、HTTP2.0
现在主要使用的http版本还是1.1（2018），但是HTTP2.0早已经出来就等待市场来完成普及，相对于1.1，2.0主要如下的优点：
- 更小的header：这使得对数据的传输效率有得到了提高
- 服务端push：服务端也可以主动推送一些消息给客户端给用户了，相信后续的网络应用体验会更加好。
- 多路复用：支持并行发送请求
- 二进制传输：1.1采用文本的形式传输数据，2.0直接通过二进制传输数据（这样在物理层不用编码直接传输）
- QUIC：Google出品基于UPD,由于多路复用还是基于TCP，还是属于一个水管的传输，当数据发送出错需要重传会发送队头阻塞，而UDP支持n*n（n>=1）传输，故UDP不会队头阻塞，且还实现了加密、重传和错误纠错，这样很肯能会替代TCP的地位。
### 七、XSS攻击

XSS（跨站脚本攻击），原理是利用网页漏洞植入恶意的攻击脚本进行攻击，XSS主要分两种：1）存储型（即使）：将恶意脚本植入在用户访问的网页中，当用户输入url马上就会执行；2）反射型（非及时）：需要欺骗用户执行某些操作才会触发。危害：1）盗取用户cookie,获取用户隐私；2）截取用户回话，进行任意操作，发送一些错误邮件、欺骗汇款等。预防措施：1）对输入输出内容进行过滤，防止脚本植入；2）设置HTTPOnly，警用js对cookie处理。3）使用CSP(内容安全策略)，通过白名单告诉客户端那些外部的资源可以使用。

## 参考文章
- [面向前端的CDN原理介绍 ](https://github.com/renaesop/blog/issues/1)
- [计算机通识](https://yuchengkai.cn/docs/zh/cs/)
- [HTTPS 原理详解](http://baijiahao.baidu.com/s?id=1570143475599137&wfr=spider&for=pc)
- [聊一聊session和cookie](https://juejin.im/post/5aede266f265da0ba266e0ef)
- [Web安全基础](https://juejin.im/post/5aeebeac5188256712786c6d)
- [XSS攻击那些事儿](https://juejin.im/entry/5a116ec4f265da4326526f10)
- [［前端］代理知识入门介绍](https://www.cnblogs.com/sxlfzhy/p/6680281.html)
- [谁说前端不需要懂-Nginx反向代理与负载均衡](https://juejin.im/post/5b01336af265da0b8a67e5c9)