# TCP和UDP
> 2018.8.4
## 前言
    由于想写在网络小结中，但是发现内容有点过于多，违背了写网络小结的意义，就单独拧出来写一遍。
## 正文

### 一、 UDP
    UDP是一种无连接无状态的协议。
UDP有两大特性：不可靠和高效。不可靠：1）由于UDP是无连接的，就把无法确认对方的状态；2）UDP是无阻塞控制的，一直以一种恒定的速度发送报文，这就会导致经常丢包的现象；3）UDP传输数据的不可靠，由于没有确认和重传机制，传输的数据不能保证是完整可靠的。高效：1）UDP报文的头部只有8字节，非常小对于数据传输效率有很大的提升；2）UDP实现简单，没有复杂的确认、重传机制，数据传输效率高。UDP的传输方式比较多样化，支持n对n(n>=1),也就是支持单播、多播和广播。现在大多数实时性比较高的数据传输(直播、通话等)都依赖UDP。
### 二、TCP
    TCP是一种面向连接无状态的协议，能够实现全双工通讯。

#### 1.TCP的头部就复杂很多：
- Sequence number：使得传输的报文有序，便于后续的拼接以及指定那些报文需要重传
- Acknowledgement Numbe： 表示接收端期望传输的一个报文的序号，也表示上一个序号已经接受到
- Window Size： 表示接收端还能接受多少字节，用于流量控制
- 标准符（这里主要简介后续会涉及到的）

    - ACK：ACK = 1表示确认好字段有效
    - SYN：当SYN = 1、ACK = 0表示该报文为连接请求报文，当SYN = 1、ACK = 0表示该报文为同意建立连接的应答报文
    - FIN：FIN = 1表示该报文为释放连接的请求报文
#### 2. 三次握手
起初两端状态都是CLOSED,然后双方都开始建立TCB，服务端建立完后则会进入LINSTEN状态；第一次握手：客户端发送一个连接请求报文（SYN = 1,ACK = 0，然后客户端进入SYN-SENT状态；第二次握手：服务端接受到请求后，如果同意连接，会发送一个同意建立连接的应答报文（SYN = 1,ACK = 1),然后进入SYN-RECEIVED状态；第三次握手：客户端接受到应答报文好，会回复一个确认报文（ACK=1），客户端则进入ESTABLISHED状态，而服务端接受到确认报文以后也进入ESTABLISHED状态。

    PS为什么要进行第三次应答：目的是为了节约资源，避免不必要的等待，由于网络环境问题，有时候会出现重新发送连接请求报文，如果第一个请求在第二个请求已经到达且后续已经走完建立连接且又已经关闭连接的情况下到达服务器端，服务器就又会进入ESTABLISHED状态，而客户端则会是COLSED状态，这样会导致服务器以为连接已经建立，一直等待客户端发送请求。
![image](/img/03.jpg)
#### 3. 四次挥手
由于TCP是全双工通讯的，所以两边都要发送FIN和ACK。第一次挥手：客户端已经数据传输完毕会发送一个释放连接的请求；第二次挥手：服务端接受到上一个请求后，会告诉应用层要释放TCP连接，然后会发送一个确认关闭的应答（ACK = 1）,并进入Close_Wait状态，表示客户端到服务端的连接已经释放，但是服务端到客户端还是能发送数据（由于全双工通讯）；第三次挥手：服务端如果还有未发送完的数据，则会在数据发送完后（在双方规定的时间内发送完，否则客户端会以为需要重传数据），向客户端发送释放请求报文，然后服务端进入LAST_ACK状态；第四挥手：客户端接受到释放请求连接后，会发送一个确认报文（ACK=1)，然后会进入一个TIME_WAIT状态，在2MSL（MSL:最大段生存期，指报文段在网络中最大生存时间，如果超时则会被抛弃）后，没有收到服务端的重新发送的请求化，会进入CLOSE状态，服务端在接受到确认请求后也进入CLOSE状态。

    ps为什么客户端要等待2MSL：如果客户端直接进入COLSE状态，而服务端由于网络原因没有接受到确认报文，服务端会以为客户端没有接受到释放连接报文则会重新发送，而此时客户端就不会做出应答，服务端一直走这个死循环，导致资源的浪费。
![image](/img/04.png)

#### 4.流量控制

#### 5.拥塞处理

### 三、参考文章
- [计算机通识](https://yuchengkai.cn/docs/zh/cs/)